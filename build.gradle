allprojects {
	apply plugin: 'java'
	apply plugin: 'checkstyle'
	apply plugin: 'jacoco'
	apply plugin: 'pmd'

	dependencies {
		implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
		implementation 'org.springframework.boot:spring-boot-starter-web'
		implementation 'org.apache.httpcomponents:httpclient'
		implementation 'com.google.code.gson:gson'

		runtimeOnly 'mysql:mysql-connector-java'

		testImplementation 'org.junit.jupiter:junit-jupiter-api:5.6.2' 
		testImplementation 'org.springframework.boot:spring-boot-starter-test'

		testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine' 
	}

	repositories {
		mavenCentral()
	}


	tasks.named('test') {
		useJUnitPlatform()
		jacoco {
			enabled = true
		}
	}

	jacocoTestReport {
		dependsOn test
	}

	jacocoTestCoverageVerification() {
		dependsOn test
		violationRules {
			rule {
				enabled = true
				element = 'CLASS'

				limit {
					counter = 'BRANCH'
					value = 'COVEREDRATIO'
					minimum = 0.1
				}
			}
		}
	}

	checkstyle {
		toolVersion "8.37"
		configFile = file("${rootDir}/config/checkstyle/checkstyle.xml")
		configProperties = [
				'checkstyle.cache.file': "${buildDir}/checkstyle.cache",
		]
		ignoreFailures = true
		showViolations = true
		sourceSets = []
	}

	pmd {
		incrementalAnalysis = true
		sourceSets = []
	}
}